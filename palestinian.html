<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>UNEC App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- FONT & BASICS --- */
        
        @font-face { font-family: 'Avenir Next'; src: url('assets/AvenirNextLTPro-Regular copia.otf') format('opentype'); font-weight: 400; }
        @font-face { font-family: 'Avenir Next'; src: url('assets/avenir-next-demi-bold.otf') format('opentype'); font-weight: 500; }

        :root {
            --primary-blue: #8AA1CE;
            --selected-gray: #B0B0B0;
            --bg-color: #F6F9FF; 
            --text-dark: #0E0E0E;
            --text-light: #0E0E0E;
            --pure-white: #F6F9FF;
            --anim-curve: cubic-bezier(0.2, 0.8, 0.2, 1);
            --circle-bg: #E3E8F0;
            --soft-shadow: 0 0px 15px rgba(0,0,0,0.1);
            --deep-shadow: 0 0px 15px rgba(0,0,0,0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        html, body { height: 100%; width: 100%; overflow: hidden; background-color: #d1dbe8; display: flex; justify-content: center; align-items: center; font-family: 'Avenir Next', sans-serif; }

        .mobile-container { width: 100vw; height: 100dvh; max-width: 100vw; max-height: 100dvh; background-color: var(--bg-color); border-radius: 0; box-shadow: none; position: relative; display: flex; flex-direction: column; overflow: hidden; }
        .screen-mask { width: 100%; height: 100%; border-radius: 0; overflow: hidden; position: relative; display: flex; flex-direction: column; background-color: var(--bg-color); z-index: 1; }

        /* --- HEADER --- */
        .header { 
            position: absolute; top: 0; left: 0; right: 0; 
            height: calc(83px + 0px); 
            padding: 0 24px 20px 24px; 
            z-index: 50; 
            display: flex; align-items: flex-end; 
            background: none; 
            pointer-events: none; transition: opacity 0.3s; 
        }
        .header.home-mode { opacity: 1; }
        .header.home-mode h1 { opacity: 0; } 
        h1 { 
            color: var(--primary-blue); font-size: 32px; font-weight: 600; 
            text-transform: uppercase; pointer-events: auto; transition: opacity 0.3s; margin: 0; line-height: 1; 
        }
        #page-title { margin-top: 50px;}

        /* --- CONTENT WRAPPER --- */
        .content { 
            flex: 1; padding: 0; 
            overflow: hidden; 
            position: relative; z-index: 10; 
        }
        .dynamic-wrapper { position: relative; height: 100%; width: 100%; transition: opacity 0.5s var(--anim-curve); }

        /* --- VIEW SECTIONS --- */
        .view-section { 
            width: 100%; height: 100%; 
            position: absolute; top: 0; left: 0; 
            opacity: 0; transform: translateY(20px); 
            pointer-events: none; visibility: hidden; 
            transition: opacity 0.4s ease, transform 0.4s var(--anim-curve);
            padding: 0 24px; 
            padding-top: calc(88px + 0px) !important; 
            padding-bottom: calc(140px + env(safe-area-inset-bottom, 20px));
            overflow-y: auto; 
            scrollbar-width: none; 
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
            touch-action: pan-y;
        }

        .view-section.active { opacity: 1; transform: none; pointer-events: auto; visibility: visible; }
        ::-webkit-scrollbar { display: none; }

        #home-view { padding-top: 0px !important; }

        /* --- FLOATING MENU --- */
        .floating-menu-container { position: absolute; top: calc(50px + 0px); right: 38px; z-index: 2000; display: flex; align-items: flex-start; justify-content: flex-end; transition: opacity 0.3s ease, visibility 0.3s ease; opacity: 1; visibility: visible; }
        .floating-menu-container.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
        .glass-circle { width: 48px; height: 48px; border-radius: 50%; background-color: rgba(138, 161, 206, 0.25); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.4); box-shadow: var(--soft-shadow); display: flex; justify-content: center; align-items: center; cursor: pointer; transition: transform 0.2s; }
        .glass-circle:active { transform: scale(0.9); }
        .glass-circle i { font-size: 20px; color: #000; opacity: 0.9; }
        .menu-trigger { position: absolute; right: 0; top: 0; transition: all 0.3s var(--anim-curve); }
        .menu-expanded-options { display: flex; gap: 15px; opacity: 0; pointer-events: none; transform: translateX(20px); transition: all 0.4s var(--anim-curve); }
        .menu-item-wrapper { display: flex; flex-direction: column; align-items: center; gap: 6px; }
        .menu-label { font-size: 14px; font-weight: 600; color: #000; font-family: 'Avenir Next', sans-serif; text-shadow: 0 0 10px rgba(255,255,255,0.8); }
        .floating-menu-container.active .menu-trigger { opacity: 0; transform: scale(0.5); pointer-events: none; }
        .floating-menu-container.active .menu-expanded-options { opacity: 1; pointer-events: auto; transform: translateX(0); }

        /* --- COMPONENTS --- */
        .home-profile-card { background: var(--pure-white); border-radius: 32px; overflow: hidden; box-shadow: var(--soft-shadow); margin-bottom: 20px; margin-left: 2px; margin-right: 2px; margin-top: 35px; position: relative; }
        
        .home-profile-img { width: 100%; height: 345px; position: relative; background-color: #ddd; }
        .home-profile-img img { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; z-index: 1; }
        .home-img-gradient { position: absolute; bottom: 0; left: 0; width: 100%; height: 150px; background: linear-gradient(to top, var(--pure-white) 20%, transparent); pointer-events: none; z-index: 2; }
        
        .home-profile-info { padding: 0 20px 25px; text-align: center; position: relative; z-index: 5; margin-top: -40px; }
        .home-profile-info h2 { font-size: 32px; font-weight: 600; color: var(--text-dark); margin-bottom: 5px; }
        .cryo-label { font-size: 15px; color: var(--text-dark); display: block; margin-bottom: 30px; opacity: 0.9; }
        .profile-stats-grid { display: flex; justify-content: space-between; padding: 0 10px; }
        .stat-item { display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .stat-label { font-size: 14px; color: #555; } .stat-value { font-size: 18px; color: #1A1A1A; font-weight: 600; }

        .ui-parent-container { border-radius: 32px; overflow: visible; box-shadow: var(--soft-shadow); display: flex; flex-direction: column; z-index: 1000; background: var(--pure-white); position: relative; height: 140px; transition: height 0.5s var(--anim-curve); margin-bottom: 20px; margin-left: 2px; margin-right: 2px; }
        .header-tab { border-radius: 32px; border-top-right-radius: 32px; overflow: visible; background-color: var(--pure-white); box-shadow: var(--soft-shadow); padding: 17px 15px; cursor: pointer; height: 93px; flex-shrink: 0; position: relative; z-index: 2; }
        .icon-grid { display: flex; justify-content: space-between; align-items: center; }
        .squircle { width: 44px; height: 44px; background-color: rgba(0, 0, 0, 0.05); border-radius: 12px; display: flex; justify-content: center; align-items: center; font-size: 18px; color: var(--text-dark); overflow: hidden; }
        .squircle-item { display: flex; flex-direction: column; align-items: center; gap: 8px; }
        .fractional-label { font-family: 'JetBrains Mono', monospace; font-size: 10px; font-weight: 500; }
        .v-divider { width: 1px; height: 60px; background-color: #D1D1D6; }
        .permanent-title { height: 45px; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 800; color: var(--text-dark); letter-spacing: 0.15em; text-transform: uppercase; font-family: 'Inter', sans-serif; flex-shrink: 0; border-bottom: none; position: relative; z-index: 2; }
        .content-body { background-color: var(--pure-white); padding: 0px 24px; opacity: 0; transition: opacity 0.3s ease; pointer-events: none; overflow: hidden; border-bottom-left-radius: 32px; border-bottom-right-radius: 32px; }
        .ui-parent-container.expanded .content-body { opacity: 1; pointer-events: auto; }
        .flow-list { padding-bottom: 20px; width: 100%; }
        
        .table-row { display: flex; align-items: center; padding: 18px 0; border-bottom: 1px solid #E5E5EA; cursor: pointer; }
        .table-row:last-child { border-bottom: none; }
        .table-row:active { opacity: 0.6; }

        .glyph { font-size: 20px; color: #000; width: 35px; text-align: center; margin-right: 15px; display: flex; justify-content: center; align-items: center; }
        .label-roba { font-size: 16px; font-weight: 400; color: var(--text-dark); font-family: 'Inter', sans-serif; }

        /* --- STILI BLOCCO ELEMENTI (LOCKED) --- */
        .table-row.locked, 
        .file-list-item.locked {
            pointer-events: none;
            position: relative;
            background-color: none; /* Visibile Grigio */
        }
        .table-row.locked .glyph, 
        .table-row.locked div, 
        .file-list-item.locked .file-icon-left, 
        .file-list-item.locked .file-text {
            opacity: 0.4;
            filter: blur(2px) grayscale(100%);
        }
        .table-row.locked .fa-chevron-right,
        .file-list-item.locked .file-arrow-right {
            display: none;
        }
        .table-row.locked::after,
        .file-list-item.locked::after {
            content: "\f023";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 14px;
            color: #8899B9;
            opacity: 1;
            filter: none;
        }

        .generic-card { background-color:var(--bg-color); border-radius: 24px; padding: 20px; box-shadow: var(--soft-shadow); margin-bottom: 20px; margin-left: 2px; margin-right: 2px; transition: transform 0.15s; position: relative; overflow: hidden; }
        .generic-card:active { transform: scale(0.99); }
        .generic-card p { font-size: 15px; color: #333; line-height: 1.5; margin: 0; }
        .generic-card h3 { font-size: 18px; font-weight: 600; color: var(--text-dark); margin-bottom: 8px; margin-top: 0; text-transform: uppercase; } 
        .blue-title, .generic-card h3.blue-title { color: var(--primary-blue); }
        
        .generic-card.locked { pointer-events: none; background-color: #F8F9FB; }
        .generic-card.locked .content-blur-wrapper { opacity: 0.4; filter: blur(5px) grayscale(100%); }
        .generic-card.locked .lock-overlay { opacity: 1; pointer-events: none; }

        .text-card { background-color: #FFFFFF; margin-bottom: 20px; padding: 24px; box-shadow: var(--soft-shadow); border-radius: 30px; height: auto; transition: transform 0.15s; }
        .text-card:active { transform: scale(0.99); }
        .text-card p { overflow-wrap: break-word; line-height: 1.6; color: #333; margin-bottom: 15px; }
        .text-card h3 { font-size: 20px; font-weight: 600; color: var(--text-dark); margin-bottom: 10px; margin-top: 15px; } 
        .subtitle { font-size: 16px; color: var(--text-light); margin-bottom: 10px; font-weight: 400; margin-left: 0; margin-right: 0; }
        
        .calendar-container { margin-bottom: 20px; padding: 0; opacity: 0; display: flex; justify-content: center; }
        .animate-entrance { animation: introSlideUp 0.6s var(--anim-curve) forwards; }
        @keyframes introSlideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; text-align: center; font-size: 14px; font-weight: 600; color: #333; width: 100%; max-width: 330px; }
        .day { width: 36px; height: 36px; display: flex; justify-content: center; align-items: center; border-radius: 50%; cursor: pointer; margin: 0 auto; font-family: 'Inter', sans-serif; transition: all 0.2s; }
        .day:active { transform: scale(0.85); background-color: #ddd; }
        .day.selected { background-color: var(--selected-gray); color: white; transform: scale(1.1); box-shadow: var(--soft-shadow); }
        .day.today { background-color: var(--primary-blue) !important; color: white !important; box-shadow: var(--soft-shadow); }

        .archive-stack { display: flex; flex-direction: column; padding-top: 0px; }
        .folder-item { position: relative; width: 100%; margin-bottom: -45px; transition: margin-bottom 0.5s var(--anim-curve), transform 0.5s var(--anim-curve); z-index: 1; cursor: pointer; transform: translate3d(0,0,0); }
        .folder-item:last-child { margin-bottom: 0; }
        .folder-tab-area { height: 40px; width: 50%; background-color: #E2E6EA; border-top-left-radius: 20px; border-top-right-radius: 20px; display: flex; align-items: center; padding-left: 20px; font-size: 12px; font-weight: 600; color: var(--primary-blue); text-transform: uppercase; position: relative; z-index: 1; box-shadow: inset 0 -5px 10px rgba(0,0,0,0.05); transition: background-color 0.3s; }
        .folder-face { 
            background-color:var(--bg-color); border-radius: 25px; border-top-left-radius: 0; height: 120px; position: relative; top: -1px; z-index: 2; padding: 20px; 
            box-shadow: var(--soft-shadow);
            transition: height 0.5s var(--anim-curve), background-color 0.3s, box-shadow 0.3s; overflow: hidden; display: flex; flex-direction: column; will-change: height; 
        }
        .folder-label-large { font-size: 24px; font-weight: 500; color: var(--text-dark); max-height: 0; opacity: 0; margin-bottom: 0; transform: translateY(-20px); transition: all 0.5s var(--anim-curve); }
        .folder-index { position: absolute; top: 33%; left: 20px; transform: translateY(-50%); display: flex; align-items: center; gap: 8px; transition: all 0.6s var(--anim-curve); z-index: 5; }
        .count-badge { font-size: 14px; font-weight: 600; color: var(--text-light); letter-spacing: 1px; }
        .pittogram { width: 40px; height: 40px; background-color: rgba(0,0,0,0.05); border-radius: 12px; display: flex; justify-content: center; align-items: center; color: #1A1A1A; font-size: 18px; transition: all 0.5s ease; overflow: hidden; }
        .folder-icon-bg { position: absolute; right: -10px; bottom: -15px; font-size: 60px; color: rgba(136, 153, 185, 0.1); transform: rotate(-10deg); transition: 0.5s; }
        
        .folder-item.active { margin-bottom: 20px; z-index: 100 !important; transform: scale(1.02); }
        .folder-item.active .folder-tab-area { background-color: var(--primary-blue); color: white; }
        .folder-item.active .folder-face { 
            background-color: var(--bg-color); 
            box-shadow: var(--soft-shadow); 
        }

        .folder-item.active .folder-label-large { max-height: 40px; opacity: 1; margin-bottom: 10px; transform: translateY(0); }
        .folder-item.active .folder-index { top: 70px; left: 20px; transform: translateY(0); }
        .folder-content { opacity: 0; transition: opacity 0.3s 0.2s ease; margin-top: 60px; pointer-events: none; }
        .folder-item.active .folder-content { opacity: 1; pointer-events: auto; }

        .file-list-item { display: flex; align-items: center; padding: 15px 0; border-bottom: 0.5px solid #000000; cursor: pointer; transition: background 0.2s; }
        .file-list-item:active { opacity: 0.6; transform: scale(0.98); }
        .file-list-item:last-child { border-bottom: none !important; }
        .file-icon-left { width: 30px; font-size: 16px; color: var(--primary-blue); text-align: center; margin-right: 10px; display: flex; justify-content: center; align-items: center; }
        .file-text { flex: 1; }
        .file-text h4 { font-size: 14px; color: var(--text-dark); margin-bottom: 2px; font-weight: 600; }
        .file-text span { font-size: 11px; color: #0E0E0E; text-transform: uppercase; font-weight: 400; }
        .file-arrow-right { font-size: 14px; color: #0E0E0E; margin-left: 10px;}

        .btn-back { background: none; border: none; color: var(--text-dark); font-weight: 600; font-size: 14px; cursor: pointer; text-transform: uppercase; display: inline-flex; align-items: center; gap: 8px; margin-bottom: 15px; padding: 5px 0; transition: opacity 0.2s; }
        .back-btn-container { text-align: left; margin-bottom: 0px; padding-left: 5px; }
        
        .categories-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; padding: 5px; margin-bottom: 30px; }
        
        .cat-card { aspect-ratio: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; background-color:var(--bg-color); box-shadow: var(--deep-shadow); border-radius: 30px; position: relative; overflow: hidden; transition: transform 0.2s; }
        .cat-card:active { transform: scale(0.95); }
        .cat-content { display: flex; flex-direction: column; align-items: center; width: 100%; }
        
        .cat-icon { font-size: 55px; margin-bottom: 15px; color: black; display: flex; justify-content: center; align-items: center; }
        .cat-icon .custom-img-icon { width: 55px; height: 55px; }

        .cat-title { font-weight: 500; font-size: 16px; color: var(--text-dark); }
        .cat-card.locked { background-color: var(--bg-color); pointer-events: none; }
        .cat-card.locked .cat-content { opacity: 0.4; filter: blur(4px) grayscale(100%); }
        .lock-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; opacity: 0; }
        .cat-card.locked .lock-overlay { opacity: 1; }
        .lock-icon { font-size: 24px; color: #8899B9; margin-bottom: 5px; }
        .lock-text { font-size: 12px; font-weight: 600; color: #8899B9; text-transform: uppercase; letter-spacing: 1px; text-align: center; line-height: 1.4; padding: 0 10px; }

        .notification-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: var(--primary-blue);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
            font-weight: 600; 
            box-shadow: var(--soft-shadow);
            z-index: 10;
        }

        .immersive-card { background-color: var(--bg-color); border-radius: 32px; padding: 24px; box-shadow: var(--deep-shadow); display: flex; flex-direction: column; gap: 20px; min-height: 70vh; margin-bottom: 40px; margin-left: 2px; margin-right: 2px; margin-top: 5px; animation: fadeInCard 0.4s ease-out; position: relative; transition: transform 0.15s; }
        .immersive-card:active { transform: scale(0.995); }
        @keyframes fadeInCard { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .card-title { font-size: 32px; font-weight: 600; color: var(--text-dark); margin: 0; font-family: 'Avenir Next', sans-serif; letter-spacing: -0.5px; } 
        .card-image-container { width: 100%; height: 260px; border-radius: 24px; overflow: hidden; background-color: var(--bg-color); box-shadow: var(--soft-shadow), inset 0 0 20px rgba(0,0,0,0.05); position: relative; }
        .card-image-container img { width: 100%; height: 100%; object-fit: cover; }
        .card-tag { position: absolute; top: 15px; left: 15px; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); padding: 6px 12px; border-radius: 12px; font-size: 11px; font-weight: 600; color: var(--text-dark); text-transform: uppercase; letter-spacing: 0.5px; box-shadow: var(--soft-shadow); } 
        
        .equation-row {
            display: flex;
            align-items: center;
            justify-content: center; 
            gap: 10px;        
            width: 100%;
            height: 20px;            
            padding: 0;
            margin: 0px 0;
            box-sizing: border-box;
        }

        .custom-img-icon {
            width: 100%;        
            height: 55%;        
            object-fit: contain;
            margin: 0;
            padding: 0;
        }

        .equation-row .custom-img-icon,
        .equation-row .equation-icon,
        .equation-row i {
            width: 20px !important; 
            height: 70px !important; 
            font-size: 20px;        
            color: var(--text-dark);
            margin: 0 !important;
            flex-shrink: 0;
        }
        
        .equation-row span {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-dark);
        }

        /* --- PLANS VIEW STYLES --- */
        .plan-card {
            background-color:var(--bg-color);
            border-radius: 32px;
            padding: 24px;
            box-shadow: var(--soft-shadow);
            display: flex;
            flex-direction: column;
            gap: 15px;
            position: relative;
        }
        .plan-title {
            font-size: 16px;
            font-weight: 600; 
            color: var(--text-dark);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .plan-features {
            list-style: none;
            padding: 0;
            margin: 0;
            margin-bottom: 10px;
        }
        .plan-features li {
            font-size: 14px;
            color: #333;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
            line-height: 1.4;
        }
        .plan-features li::before {
            content: "\f061"; 
            font-family: "Font Awesome 6 Free"; 
            font-weight: 600; 
            
            position: absolute;
            left: 0;
        }
        .plan-footer {
            margin-top: auto;
            display: flex;
            flex-direction: column;
            align-items: center; 
            gap: 15px;
        }
        .plan-price {
            font-size: 18px;
            font-weight: 600; 
            color: var(--text-dark);
            align-self: flex-end; 
            margin-right: 5px;
        }
        .btn-choose {
            background-color: var(--primary-blue);
            color: white;
            border: none;
            padding: 12px 0;
            width: 100%;
            border-radius: 25px;
            font-weight: 600; 
            font-size: 13px;
            cursor: pointer;
            text-transform: uppercase;
            box-shadow: var(--soft-shadow);
            transition: transform 0.2s;
        }
        .btn-choose:active {
            transform: scale(0.95);
        }
        
        /* Stile per le icone personalizzate dentro i cerchi (Menu e Personal Card) */
        .custom-circle-icon {
            width: 24px;  
            height: 24px;
            object-fit: contain;
            display: block; 
        }
        .card-description { font-size: 16px; color: var(--text-light); line-height: 1.7; font-weight: 400; }
        .detail-table-container { width: 100%; display: flex; flex-direction: column; gap: 0; margin-bottom: 0px; background: var(--bg-color); padding: 0px; }
        .detail-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 0.25px solid var(--text-dark); }
        .detail-row:last-child { border-bottom: none; }
        .detail-label { font-size: 14px; font-weight: 600; color:var(--text-dark); text-transform: uppercase; }
        .detail-value { font-size: 14px; font-weight: 600; color: var(--text-dark); text-align: right; }

        #personal-view { display: flex; flex-direction: column; min-height: calc(100% - 140px); }
        .personal-card { background-color: var(--bg-color); border-radius: 24px; padding: 24px; box-shadow: var(--soft-shadow); margin-bottom: 0px; margin-top:14px; margin-right: 2px; transition: transform 0.2s; }
        .personal-card:active { transform: scale(0.99); }
        .p-card-label { font-size: 12px; font-weight: 600; color:var(--text-dark); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; } 
        .p-card-label-normal { font-size: 18px; font-weight: 400; color: var(--text-dark); margin: 0; overflow: visible; }
        .plan-header-row { display: flex; align-items: center; justify-content: space-between; gap: 8px; margin-bottom: 12px; flex-wrap: nowrap; }
        .plan-header-row .p-card-label-normal { flex: 1 1 auto; min-width: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .plan-header-row .plan-price { font-size: 24px; font-weight: 600; color: var(--text-dark); letter-spacing: -1px; margin-left: 0px; flex: 0 0 auto; } 
        @media (max-width: 340px) {
            .plan-header-row { flex-direction: column; align-items: flex-start; gap: 6px; }
            .plan-header-row .plan-price { margin-top: 6px; font-size: 18px; margin-left: 0; }
        }
        .cultures-row { display: flex; gap: 20px; align-items: flex-start; }
        .culture-circle-wrapper { display: flex; flex-direction: column; align-items: center; gap: 8px; }
        .culture-circle { width: 48px; height: 48px; border-radius: 50%; background-color: rgba(138, 161, 206, 0.25); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.4); display: flex; justify-content: center; align-items: center; font-size: 20px; color: var(--text-dark); box-shadow: var(--soft-shadow); transition: transform 0.2s; cursor: pointer; }
        .culture-circle:active { transform: scale(0.9); }
        .culture-circle i { font-size: 20px; color: #000; opacity: 0.9; }
        .culture-name { font-size: 13px; font-weight: 600; color: var(--text-dark); } 
        .plan-price-row { display: flex; flex-direction: row; align-items: center; gap: 12px; }
        .plan-price-row .btn-view-plans { margin-left: auto; }
        @media (max-width: 480px) {
            .plan-price-row { flex-direction: column; align-items: stretch; gap: 8px; }
            .plan-price-row .btn-view-plans { margin-left: 0; width: 100%; }
        }
        .plan-price { font-size: 24px; font-weight: 600; color: var(--text-dark); letter-spacing: -1px; } 
        .btn-view-plans { background-color: var(--primary-blue); color: var(--bg-color); border: none; padding: 12px 24px; border-radius: 20px; font-weight: 600; font-size: 12px; cursor: pointer; text-transform: uppercase; letter-spacing: 0.5px; transition: transform 0.2s; box-shadow: var(--soft-shadow); } 
        .btn-view-plans:active { transform: scale(0.95); }
        
        /* --- BOTTOM ACTIONS FIXED POSITION --- */
        .bottom-actions {
            position: fixed; /* Ancoraggio alla viewport */
            bottom: calc(95px + env(safe-area-inset-bottom, 20px)); /* Sollevati sopra la navbar */
            left: 50%; 
            transform: translateX(-50%); /* Centratura geometrica assoluta */
            
            width: calc(100% - 48px); /* Larghezza dinamica meno i margini laterali */
            max-width: 327px; /* Vincolo per non esplodere su schermi desktop */
            
            display: flex; 
            gap: 12px; 
            justify-content: center; 
            z-index: 150; 
        }
            
        .bottom-actions .btn-action-pill { max-width: calc(50% - 7.5px); } 
        .btn-action-pill { flex: 1; background-color: var(--primary-blue); color: var(--bg-color); border: none; padding: 14px 0; border-radius: 25px; font-weight: 600; font-size: 13px; cursor: pointer; text-transform: uppercase; text-align: center; box-shadow: var(--soft-shadow); transition: transform 0.2s; } 
        .btn-action-pill:active { transform: scale(0.97); }

        .bottom-nav { position: absolute; bottom: calc(30px + env(safe-area-inset-bottom, 20px)); left: 20px; right: 20px; height: 60px; background: linear-gradient(180deg, rgba(255,255,255,0.28), rgba(255,255,255,0.04)); backdrop-filter: blur(22px) saturate(140%); -webkit-backdrop-filter: blur(22px) saturate(140%); box-shadow: var(--soft-shadow), inset 0 1px 0 rgba(255,255,255,0.3); border-radius: 30px; display: flex; justify-content: space-around; align-items: center; padding-bottom: calc(6px + env(safe-area-inset-bottom, 0px)); z-index: 100; transition: transform 0.14s var(--anim-curve), box-shadow 1s var(--anim-curve); overflow: hidden; }
        .bottom-nav::before { content: ""; position: absolute; inset: 0; pointer-events: none; background: radial-gradient(150% 50% at 50% 8%, rgba(255,255,255,0.12), rgba(255,255,255,0) 50%); mix-blend-mode: overlay; opacity: 0.35; }
        .bottom-nav:active { transform: translateY(0.5px); box-shadow: var(--soft-shadow); }
        .nav-item { font-size: 20px; color: var(--text-dark); cursor: pointer; opacity: 0.3; transition: all 0.22s cubic-bezier(0.2, 0.8, 0.2, 1); border: none; background: none; }
        .nav-item.active { opacity: 1; transform: scale(1.15) translateY(0px); color: var(--primary-blue); }
        
        /* Stile per la tua icona personalizzata nella navbar */
        .nav-custom-img {
            width: 24px;
            height: 24px;
            object-fit: contain;
            transition: all 0.2s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        .nav-item.active .nav-custom-img {
            filter: invert(65%) sepia(12%) saturate(1076%) hue-rotate(185deg) brightness(93%) contrast(89%);
            transform: scale(1.15); 
            opacity: 1;
        }
        /* IMAGE UTILITIES */
        .pittogram .custom-img-icon { width: 60%; height: 60%; }
        .glyph .custom-img-icon { width: 24px; height: 24px; }
        .file-icon-left .custom-img-icon { width: 20px; height: 20px; }
        .cat-icon .custom-img-icon { width: 40px; height: 40px; }

        .top-gradient { position: absolute; top: 0; left: 0; right: 0; height: calc(120px + 50px + env(safe-area-inset-top, 0px)); pointer-events: none; background: linear-gradient(180deg, rgba(255,255,255,1) 0%, rgba(255,255,255,0.95) 40%, rgba(255,255,255,0.85) 60%, rgba(255,255,255,0) 100%); z-index: 40; opacity: 0; transition: opacity 0.22s ease; }
        .top-gradient.visible { opacity: 1; }

        @media (min-width: 900px) {
            .mobile-container { width: 375px; height: 812px; border-radius: 40px; box-shadow: var(--soft-shadow); margin: 20px auto; max-width: 375px; }
            .screen-mask { border-radius: 40px; }
        }
    </style>
</head>
<body>

    <div class="mobile-container">
        <div class="screen-mask" id="screen-mask">
            
            <div class="floating-menu-container" id="floating-menu">
                <div class="glass-circle menu-trigger" onclick="toggleFloatingMenu(event)">
                     <img src="assets/icone varie/palestinian/pet/dress2.png" class="custom-circle-icon" alt="Icon">
                </div>
                <div class="menu-expanded-options">
                    <div class="menu-item-wrapper" onclick="switchTab('personal')">
                        <div class="glass-circle">
                            <img src="assets/icone varie/palestinian/pet/dress2.png" class="custom-circle-icon" alt="Icon">
                        </div>
                        <span class="menu-label">Palestinian</span>
                    </div>
                    <div class="menu-item-wrapper" onclick="toggleFloatingMenu(event)">
                        <div class="glass-circle"><i class="fas fa-plus"></i></div>
                    </div>
                </div>
            </div>

            <div class="header home-mode" id="main-header">
                <h1 id="page-title">TODAY'S<br>DISCOVERIES</h1>
            </div>
            <div class="top-gradient" aria-hidden="true"></div>

            <div class="content home-active" id="main-content">
                <div class="dynamic-wrapper" id="dynamic-wrapper">
                    
                    <div id="home-view" class="view-section active">
                        <div class="home-profile-card">
                            <div class="home-profile-img">
                                <img id="p-img" src="assets/icone varie/palestinian/Img_profilo.png" alt="Profile" onerror="this.src='https://images.unsplash.com/photo-1511367461989-f85a21fda167?w=800&q=80'">
                                <div class="home-img-gradient"></div>
                            </div>
                            <div class="home-profile-info">
                                <h2 id="p-name"></h2>
                                <span class="cryo-label" id="p-desc"></span>
                                <div class="profile-stats-grid">
                                    <div class="stat-item"><span class="stat-label">Age</span><span class="stat-value" id="p-age"></span></div>
                                    <div class="stat-item"><span class="stat-label">Culture</span><span class="stat-value" id="p-culture"></span></div>
                                    <div class="stat-item"><span class="stat-label">Location</span><span class="stat-value" id="p-loc"></span></div>
                                </div>
                            </div>
                        </div>

                        <div class="ui-parent-container" id="discovery-module">
                            <div class="header-tab" onclick="toggleDiscovery()">
                                <div class="icon-grid">
                                    <div id="discovery-icons-placeholder" style="display:contents;"></div>
                                </div>
                            </div>
                            <h2 class="section-title permanent-title" onclick="toggleDiscovery()" role="button" tabindex="0">TODAY'S DISCOVERIES</h2>
                            <div class="content-body" id="discovery-content">
                                <div class="flow-list" id="discovery-list"></div>
                            </div>
                        </div>
                    </div>

                    <div id="progress-view" class="view-section">
                        <p class="subtitle">Track your discoveries: select a day.</p>
                        <div class="calendar-container">
                            <div class="calendar-grid">
                                <div class="day today" onclick="selectDay(this, 1)">1</div><div class="day" onclick="selectDay(this, 2)">2</div><div class="day" onclick="selectDay(this, 3)">3</div><div class="day" onclick="selectDay(this, 4)">4</div><div class="day" onclick="selectDay(this, 5)">5</div><div class="day" onclick="selectDay(this, 6)">6</div><div class="day" onclick="selectDay(this, 7)">7</div><div class="day" onclick="selectDay(this, 8)">8</div><div class="day" onclick="selectDay(this, 9)">9</div><div class="day" onclick="selectDay(this, 10)">10</div><div class="day" onclick="selectDay(this, 11)">11</div><div class="day" onclick="selectDay(this, 12)">12</div><div class="day" onclick="selectDay(this, 13)">13</div><div class="day" onclick="selectDay(this, 14)">14</div><div class="day" onclick="selectDay(this, 15)">15</div><div class="day" onclick="selectDay(this, 16)">16</div><div class="day" onclick="selectDay(this, 17)">17</div><div class="day" onclick="selectDay(this, 18)">18</div><div class="day" onclick="selectDay(this, 19)">19</div><div class="day" onclick="selectDay(this, 20)">20</div><div class="day" onclick="selectDay(this, 21)">21</div><div class="day" onclick="selectDay(this, 22)">22</div><div class="day" onclick="selectDay(this, 23)">23</div><div class="day" onclick="selectDay(this, 24)">24</div><div class="day" onclick="selectDay(this, 25)">25</div><div class="day" onclick="selectDay(this, 26)">26</div><div class="day" onclick="selectDay(this, 27)">27</div><div class="day" onclick="selectDay(this, 28)">28</div><div class="day" onclick="selectDay(this, 29)">29</div><div class="day" onclick="selectDay(this, 30)">30</div><div class="day" onclick="selectDay(this, 31)">31</div>
                            </div>
                        </div>
                        <div class="categories-grid" id="shared-grid-container"></div>
                    </div>

                    <div id="archive-view" class="view-section">
                        <p class="subtitle" style="margin-left: 5px;">Your digital preservation archive.</p>
                        <div class="archive-stack" id="stack-container"></div>
                    </div>

                    <div id="universal-detail-view" class="view-section">
                        <div class="back-btn-container">
                            <button class="btn-back" onclick="switchTab('archive')">
                                <i class="fas fa-arrow-left"></i> Back
                            </button>
                        </div>
                        <div class="immersive-card">
                            <h2 class="card-title" id="uni-title">Loading...</h2>
                            <div class="card-image-container">
                                <div class="card-tag" id="uni-tag">CATEGORY</div>
                                <img id="uni-image" src="" alt="Detail">
                            </div>
                            <div class="equation-row" id="uni-icons"></div>
                            <div id="uni-table" class="detail-table-container"></div>
                            <p class="card-description" id="uni-desc">Description goes here.</p>
                        </div>
                    </div>

                    <div id="plans-view" class="view-section">
                        <div class="back-btn-container">
                            <button class="btn-back" onclick="switchTab('personal')">
                                <i class="fas fa-arrow-left"></i> BACK
                            </button>
                        </div>
                        
                        <div style="display: flex; flex-direction: column; gap: 20px; padding-bottom: 40px;">
                            
                            <div class="plan-card">
                                <h3 class="plan-title">BRONZE</h3>
                                <ul class="plan-features">
                                    <li>1 Cultural Guardian Adoption</li>
                                    <li>Basic CryoCare device</li>
                                </ul>
                                <div class="plan-footer">
                                    <div class="plan-price">$50/month</div>
                                    <button class="btn-choose" onclick="selectPlan('$50/month')">CHOOSE</button>
                                </div>
                            </div>

                            <div class="plan-card">
                                <h3 class="plan-title">SILVER</h3>
                                <ul class="plan-features">
                                    <li>2 Cultural Guardian Adoption</li>
                                    <li>CryoCare with expanded archives</li>
                                </ul>
                                <div class="plan-footer">
                                    <div class="plan-price">$100/month</div>
                                    <button class="btn-choose" onclick="selectPlan('$100/month')">CHOOSE</button>
                                </div>
                            </div>

                            <div class="plan-card">
                                <h3 class="plan-title">GOLD</h3>
                                <ul class="plan-features">
                                    <li>3 Cultural Guardian Adoption</li>
                                    <li>Personalised cultural consultation</li>
                                    <li>Annual visit to our facilities</li>
                                </ul>
                                <div class="plan-footer">
                                    <div class="plan-price">$250/month</div>
                                    <button class="btn-choose" onclick="selectPlan('$250/month')">CHOOSE</button>
                                </div>
                            </div>

                            <div class="plan-card">
                                <h3 class="plan-title">PALLADIUM</h3>
                                <ul class="plan-features">
                                    <li>5 Cultural Guardian Adoption</li>
                                    <li>Priority selection</li>
                                    <li>Naming rights on chambers</li>
                                    <li>Advisory board participation</li>
                                </ul>
                                <div class="plan-footer">
                                    <div class="plan-price">$500/month</div>
                                    <button class="btn-choose" onclick="selectPlan('$500/month')">CHOOSE</button>
                                </div>
                            </div>

                        </div>
                    </div>

                    <div id="extra-content-view" class="view-section">
                        <div class="back-btn-container">
                            <button class="btn-back" onclick="switchTab('home')">
                                <i class="fas fa-arrow-left"></i> Home
                            </button>
                        </div>
                        
                        <div id="extra-cards-container" style="display: flex; flex-direction: column; gap: 10px;">
                            </div>
                    </div>

                    <div id="personal-view" class="view-section">
                        <p class="personal-subtitle">UNEC thanks you for supporting the cryopreservation of endangered cultures.</p>
                        <div class="personal-card">
                            <h3 class="p-card-label">YOUR ADOPTED CULTURES</h3>
                            <div class="cultures-row">
                                <div class="culture-circle-wrapper">
                                    <div class="culture-circle" onclick="switchTab('personal')">
                                        <img src="assets/icone varie/palestinian/pet/dress2.png" class="custom-circle-icon" alt="Icon">
                                    </div>
                                    <span class="culture-name" id="p-cult-name">Palestinian</span>
                                </div>
                                <div class="culture-circle-wrapper">
                                    <div class="culture-circle"><i class="fas fa-plus"></i></div>
                                </div>
                            </div>
                        </div>
                        <div class="personal-card">
                            <div class="plan-header-row">
                                <h3 class="p-card-label-normal">Your plan:</h3>
                                <span class="plan-price" id="p-price">0$/month</span>
                            </div>
                            <div class="plan-price-row">
                                <button class="btn-view-plans" onclick="switchTab('plans')">VIEW PLANS</button>
                            </div>
                        </div>
                        <div class="bottom-actions">
                            <button class="btn-action-pill" onclick="switchTab('about')">WHO WE ARE</button>
                            <button class="btn-action-pill" onclick="switchTab('contact')">CONTACT US</button>
                        </div>
                    </div>
                    
                    <div id="about-view" class="view-section">
                        <div class="back-btn-container"><button class="btn-back" onclick="switchTab('personal')"><i class="fas fa-arrow-left"></i> BACK</button></div>
                        <div id="about-content-area"></div>
                    </div>

                    <div id="contact-view" class="view-section">
                        <div class="back-btn-container"><button class="btn-back" onclick="switchTab('personal')"><i class="fas fa-arrow-left"></i> BACK</button></div>
                        <div id="contact-content-area"></div>
                    </div>

                </div>
            </div>

            <div class="bottom-nav">
                <button class="nav-item active" onclick="switchTab('home')"><i class="fas fa-layer-group"></i></button>
                <button class="nav-item" onclick="switchTab('progress')"><i class="far fa-calendar-check"></i></button>
                <button class="nav-item" onclick="switchTab('archive')"><i class="far fa-folder"></i></button>
                <button class="nav-item" onclick="switchTab('personal')">
                    <img src="assets/icone varie/defaults/icona_profilo.svg" class="nav-custom-img" alt="User">
                </button>
            </div>
        
        </div> 
    </div> 

    <script>
        // =================================================================
        // --- ✏️ CONFIGURAZIONE CONTENUTI ---
        // =================================================================
        
        const DB = {
            profile: {
                name: "Ibrahim Barghouti",
                desc: "Cryoconservated since: 2078",
                img: "assets/icone varie/palestinian/Img_profilo.png", 
                age: "8",
                culture: "Palestinian",
                location: "Ramallah"
            },
            discoveries: [
                { icon: "assets/icone varie/icone_principali/food.png", isImage: true, label: "Food" },
                { icon: "assets/icone varie/icone_principali/dress.png", isImage: true, label: "Dress" },
                { icon: "assets/icone varie/icone_principali/ritual.png", isImage: true, label: "Rituals" },
                { icon: "assets/icone varie/icone_principali/memory.png", isImage: true, label: "Memory" },
                { icon: "fa-key", isImage: false, label: "Return" },
                { icon: "assets/icone varie/icone_principali/food.png", isImage: true, label: "Olive" }
            ],
            archives: [
                {
                    id: "food", label: "FOOD", title: "Aklat", 
                    icon: "assets/icone varie/icone_principali/food.png", isIconImg: true,
                    bgIcon: "assets/icone varie/icone_principali/food.png",
                    count: "1/31",
                    items: [
                        { id: "maqluba", icon: "assets/icone varie/palestinian/food/baked_food.png", isItemImg: true, title: "Maqluba", type: "Main Dish" }
                    ]
                },
                {
                    id: "clothes", label: "CLOTHES", title: "Libas", 
                    icon: "assets/icone varie/icone_principali/dress.png", isIconImg: true,
                    bgIcon: "assets/icone varie/icone_principali/dress.png", count: "3/31",
                    items: [
                        { id: "keffiyeh", icon: "assets/icone varie/palestinian/pet/dress1.png", isItemImg: true, title: "Keffiyeh", type: "Scarf" },
                        { id: "qumbaz", icon: "assets/icone varie/palestinian/pet/dress3.png", isItemImg: true, title: "Qumbaz", type: "Robe" },
                        { id: "thobe", icon: "assets/icone varie/palestinian/pet/dress2.png", isItemImg: true, title: "Thobe", type: "Dress" }
                    ]
                },
                {
                    id: "rituals", label: "RITUALS", title: "Taqalid", 
                    icon: "assets/icone varie/icone_principali/ritual.png", isIconImg: true,
                    bgIcon: "assets/icone varie/icone_principali/ritual.png", count: "1/31",
                    items: [
                        { id: "dabke", icon: "assets/icone varie/palestinian/pet/ritual.png", isItemImg: true, title: "Dabke", type: "Dance" }
                    ]
                },
                {
                    id: "memories", label: "MEMORIES", title: "Thikrayat", 
                    icon: "assets/icone varie/icone_principali/memory.png", isIconImg: true,
                    bgIcon: "assets/icone varie/icone_principali/memory.png", count: "3/31",
                    items: [
                        { id: "mem1", icon: "assets/icone varie/palestinian/memories/ico_mem_3.png", isItemImg: true, title: "Vitality", type: "Sensory" },
                        { id: "mem2", icon: "assets/icone varie/palestinian/memories/ico_mem_2.png", isItemImg: true, title: "The Iron Key", type: "Symbol" },
                        { id: "mem3", icon: "assets/icone varie/palestinian/memories/ico_mem_1.png", isItemImg: true, title: "Unseen Roots", type: "Oral History" }
                    ]
                }
            ],
            progress: [
                { id: "card-food", title: "Food", icon: "assets/icone varie/icone_principali/food.png", isImage: true },
                { id: "card-clothes", title: "Clothes", icon: "assets/icone varie/icone_principali/dress.png", isImage: true },
                { id: "card-ritual", title: "Ritual", icon: "assets/icone varie/icone_principali/ritual.png", isImage: true },
                { id: "card-memories", title: "Memories", icon: "assets/icone varie/icone_principali/memory.png", isImage: true }
            ],
            achievements: {
                'sharing': { 
                    id: 'sharing',
                    title: "Sahtain (Bon Appétit)", 
                    text: "You shared the Maqluba. Even a child knows that food tastes better when shared.",
                    unlocked: true 
                },
                'privacy': { 
                    id: 'privacy',
                    title: "Respect", 
                    text: "You stepped into the Dabke circle out of turn. Learn the rhythm first.",
                    unlocked: false 
                }
            },
            items: {
                'maqluba': {
                    tag: "RECIPE", title: "Maqluba",
                    image: "assets/icone varie/palestinian/food/foto_cibo.avif",
                    description: "Meaning 'Upside Down', this layered dish of rice, fried vegetables (cauliflower or eggplant), and meat is flipped onto a serving tray to reveal its structure.",
                    icons: [
                        { val: 'assets/icone varie/palestinian/food/food1.png', isImg: true }, 
                        { val: 'assets/icone varie/palestinian/food/food2.png', isImg: true }, 
                        { val: 'assets/icone varie/palestinian/food/food3.png', isImg: true },
                        { val: 'assets/icone varie/palestinian/food/baked_food.png', isImg: true } 
                    ],
                    details: { "Layering": "Vertical", "Action": "Flipping", "Spice": "Allspice/Cinnamon", "Occasion": "Friday Lunch" }
                },
                'keffiyeh': { 
                    tag: "SCARF", 
                    title: "Keffiyeh", 
                    image: "assets/icone varie/palestinian/pet/dress1_photo.avif", 
                    description: "The traditional black and white checkered scarf. The fishnet pattern represents the sea, the bold lines the trade routes, and the olive leaves the land.", 
                    details: { "Pattern": "Fishnet", "Color": "Black/White", "Symbolism": "Resilience", "Origin": "Agrarian" } 
                },
                'qumbaz': { 
                    tag: "ROBE", 
                    title: "Qumbaz", 
                    image: "assets/icone varie/palestinian/pet/dress2_photo.jpg", 
                    description: "A traditional long-sleeved coat worn by men, open at the front and overlapping. It represents dignity and tradition in formal gatherings.", 
                    details: { "Material": "Striped Silk/Cotton", "Closure": "Side Slit", "Accessory": "Sirwal (Pants)", "Status": "Traditional" } 
                },
                'thobe': {
                    tag: "DRESS", title: "Thobe",
                    image: "assets/icone varie/palestinian/pet/dress3_photo.jpg",
                    description: "A cross-stitch embroidered dress. Though worn by women, for a child, it represents the visual history of his village and his mother's identity.",
                    details: { "Technique": "Tatreez", "Motif": "Cypress/Star", "Region": "Ramallah", "Heritage": "UNESCO" }
                },
                'dabke': { 
                    tag: "DANCE", 
                    title: "Dabke", 
                    image: "assets/icone varie/palestinian/pet/ritual_gif.gif", 
                    description: "A folk dance combining circle and line dancing, marked by rhythmic stomping. It signifies unity, joy, and the connection of feet to the soil.", 
                    details: { "Formation": "Line/Semi-circle", "Leader": "Al-Lawih", "Action": "Stomping", "Meaning": "Solidarity" } 
                },
                'mem1': {
                    tag: "SENSORY", title: "Vitality",
                    image: "assets/icone varie/palestinian/memories/ico_mem_3.png",
                    description: "I will never forget the deep red of a split pomegranate, vibrant with life. It stains the fingers like memory stains the soul."
                },
                'mem2': {
                    tag: "SYMBOL", title: "The Iron Key",
                    image: "assets/icone varie/palestinian/memories/ico_mem_2.png",
                    description: "I remember the old iron key my father kept on a hook by the door, even though we had no house for it to open. It was heavy with hope."
                },
                'mem3': {
                    tag: "ORAL HISTORY", title: "Unseen Roots",
                    image: "assets/icone varie/palestinian/memories/ico_mem_1.png",
                    description: "I will never forget the sound of my father telling me stories about our olive trees back home, even though I never saw them.",
                    unlocked: false 
                }
            },
            about: [
                { type: 'text', content: "Established by the UN in 2075, UNEC responds to the rise in cultural conflicts, recognizing cultural preservation as a fundamental imperative for global peace." },
                { type: 'card', title: "Vision", text: "UNEC envisions a world where every culture can continue to thrive through its own community." },
                { type: 'card', title: "Mission", text: "Our mission is to preserve endangered cultures through a safe practice of cryoconservation." }
            ],
            contact: [
                { type: 'card', title: "Headquarters", text: "Our central headquarters is located <br>in a secured, climate-controlled facility in Antarctica." },
                { type: 'card', title: "Inquiries", text: "Phone/messages: +672 361 784 6525<br>Email: unec@mail.org" },
                { type: 'card', title: "Field Operations", text: "Our field operators are continuously deployed worldwide to document cultural conflict." }
            ]
        };

        // =================================================================
        // --- ⚙️ SYSTEM LOGIC ---
        // =================================================================
        let isAnimating = false;
        const currentDay = 1; 
        let currentSelectedCalendarDay = 1; 

        // HELPER PER RENDERIZZARE ICONE O IMMAGINI
        function renderIcon(val, isImg, className="") {
            if(isImg) return `<img src="${val}" class="custom-img-icon ${className}" alt="icon">`;
            return `<i class="fas ${val} ${className}"></i>`;
        }

        // --- HELPER: Go to Archive Folder ---
        function goToFolder(archiveId) {
            if (!archiveId) return;
            switchTab('archive');
            setTimeout(() => {
                const folderEl = document.querySelector(`.folder-item[data-folder-id="${archiveId}"]`);
                if (folderEl) {
                    if (!folderEl.classList.contains('active')) toggleFolder(folderEl);
                    folderEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, 420);
        }

        // --- NEW HELPER: Select Plan ---
        function selectPlan(price) {
            // Aggiorna visivamente il prezzo nella pagina Personal
            const priceEl = document.getElementById('p-price');
            if(priceEl) priceEl.innerText = price;
            
            // Torna indietro
            switchTab('personal');
        }

        // --- NEW HELPER: Render Extra Content (Locked/Unlocked) ---
        function renderExtraContent() {
            const container = document.getElementById('extra-cards-container');
            if(!container) return;

            let html = '';

            for (const key in DB.achievements) {
                const item = DB.achievements[key];
                const lockedClass = item.unlocked ? '' : 'locked';
                const lockOverlay = item.unlocked ? '' : `<div class="lock-overlay"><i class="fas fa-lock lock-icon"></i><span class="lock-text">INTERACT WITH YOUR GUARDIAN<br>TO FIND OUT</span></div>`;
                
                html += `
                    <div class="generic-card ${lockedClass}" style="margin-top: 10px; animation: fadeInCard 0.4s ease-out;">
                        <div class="content-blur-wrapper">
                            <h3 class="blue-title">${item.title}</h3>
                            <p style="color: #333; line-height: 1.6;">${item.text}</p>
                        </div>
                        ${lockOverlay}
                    </div>
                `;
            }
            container.innerHTML = html;
        }

        function initApp() {
            // 1. Profile
            document.getElementById('p-name').innerText = DB.profile.name;
            document.getElementById('p-desc').innerText = DB.profile.desc;
            document.getElementById('p-img').src = DB.profile.img;
            document.getElementById('p-age').innerText = DB.profile.age;
            document.getElementById('p-culture').innerText = DB.profile.culture;
            document.getElementById('p-loc').innerText = DB.profile.location;
            document.getElementById('p-cult-name').innerText = DB.profile.culture; 

            // --- CALCOLO DEI CONTEGGI SBLOCCATI ---
            const getUnlockedCount = (archiveId) => {
                const folder = DB.archives.find(a => a.id === archiveId);
                if (!folder) return 0;
                return folder.items.filter(item => {
                    const dbItem = DB.items[item.id];
                    // Se unlocked è undefined, lo consideriamo true (sbloccato) per default
                    return dbItem && dbItem.unlocked !== false; 
                }).length;
            };

            const getTotalCount = (archiveId) => {
                const folder = DB.archives.find(a => a.id === archiveId);
                return folder ? folder.items.length : 0;
            }

            // 2. Discoveries
            const discGrid = document.getElementById('discovery-icons-placeholder');
            let discHTML = '';
            
            DB.discoveries.forEach((d, i) => {
                if(i < 3) {
                    const targetId = DB.archives.find(a => a.label.toLowerCase() === d.label.toLowerCase())?.id || '';
                    const clickAction = targetId ? `onclick="goToFolder('${targetId}')"` : '';
                    
                    // Se è memory, usiamo il conteggio dinamico
                    if (d.label === "Memory") {
                         // Saltiamo qui, lo aggiungiamo dopo
                    } else {
                        discHTML += `<div class="squircle-item" ${clickAction}>
                                        <div class="squircle">${renderIcon(d.icon, d.isImage)}</div>
                                        <span class="fractional-label">1/1</span>
                                     </div>`;
                    }
                }
            });

            // 1. Leggo lo stato
            const isShareUnlocked = DB.achievements.sharing.unlocked;
            const isPrivUnlocked = DB.achievements.privacy.unlocked;

            const iconShare = isShareUnlocked 
                ? renderIcon('assets/icone varie/defaults/bowl.png', true) 
                : '<i class="fas fa-question"></i>';

            const iconPriv = isPrivUnlocked 
                ? renderIcon('assets/icone varie/defaults/default_covers.png', true) 
                : '<i class="fas fa-question"></i>';

            // Conteggio memorie
            const memUnlocked = getUnlockedCount('memories');
            const memTotal = getTotalCount('memories');

            // 3. Genero l'HTML
            discHTML += `
                <div class="v-divider"></div>
                
                <div class="squircle-item" onclick="goToFolder('memories')">
                    <div class="squircle">${renderIcon('assets/icone varie/icone_principali/memory.png', true)}</div>
                    <span class="fractional-label">${memUnlocked}/${memTotal}</span>
                </div>

                <div class="squircle-item" onclick="switchTab('extra-content')">
                    <div class="squircle">${iconShare}</div>
                    <span class="fractional-label">${isShareUnlocked ? '1/1' : '0/1'}</span>
                </div>

                <div class="squircle-item" onclick="switchTab('extra-content')">
                    <div class="squircle">${iconPriv}</div>
                    <span class="fractional-label">${isPrivUnlocked ? '1/1' : '0/1'}</span>
                </div>`;
            
            document.getElementById('discovery-icons-placeholder').innerHTML = discHTML;
            
            // Inizializza il rendering anche se nascosto
            renderExtraContent();

            // 3. Generazione LISTA DISCOVERY (table-row) con logica Locked
            let listHTML = '';
            DB.archives.forEach(folder => {
                folder.items.forEach(item => {
                    // Controllo stato
                    const fullItem = DB.items[item.id];
                    const isLocked = fullItem && fullItem.unlocked === false;
                    
                    const lockedClass = isLocked ? 'locked' : '';
                    // Se è bloccato, rimuoviamo l'onclick
                    const clickAttr = isLocked ? '' : `onclick="openItem('${item.id}')"`;
                    const cursorStyle = isLocked ? 'cursor: default;' : 'cursor: pointer;';

                    listHTML += `
                    <div class="table-row ${lockedClass}" ${clickAttr} style="${cursorStyle}">
                        <div class="glyph">${renderIcon(item.icon, item.isItemImg)}</div>
                        <div style="display: flex; flex-direction: column; flex: 1;">
                            <span class="label-roba" style="font-weight: 600;">${item.title}</span>
                            <span style="font-size: 11px; color: #666; text-transform: uppercase; margin-top: 2px;">${item.type}</span>
                        </div>
                        <i class="fas fa-chevron-right" style="font-size: 12px; color: #0E0E0E; margin-left: 10px;"></i>
                    </div>`;
                });
            });
            document.getElementById('discovery-list').innerHTML = listHTML;

            // 3. Progress Grid
            renderProgressGrid(currentDay);

            // 5. Generazione ARCHIVE STACK (Cartelle e File)
            const stack = document.getElementById('stack-container');
            stack.innerHTML = '';
            
            DB.archives.forEach(folder => {
                let itemsHTML = '';
                
                // Calcolo conteggio per badge cartella
                const folderUnlocked = getUnlockedCount(folder.id);
                const folderTotal = folder.items.length;
                
                folder.items.forEach(item => {
                    // Controllo stato item
                    const fullItem = DB.items[item.id];
                    const isLocked = fullItem && fullItem.unlocked === false;
                    const lockedClass = isLocked ? 'locked' : '';
                    const clickAttr = isLocked ? '' : `onclick="openItem('${item.id}')"`;

                    itemsHTML += `
                        <div class="file-list-item ${lockedClass}" ${clickAttr}>
                            <div class="file-icon-left">${renderIcon(item.icon, item.isItemImg)}</div>
                            <div class="file-text"><h4>${item.title}</h4><span>${item.type}</span></div>
                            <i class="fas fa-chevron-right file-arrow-right"></i>
                        </div>`;
                });

                // Aggiorna il badge con il conteggio reale (Sbloccati / Totali)
                const dynamicCount = `${folderUnlocked}/${folderTotal}`;

                const folderHTML = `
                    <div class="folder-item" data-folder-id="${folder.id}" onclick="toggleFolder(this)">
                        <div class="folder-tab-area">${folder.label}</div>
                        <div class="folder-face">
                            <div class="folder-label-large">${folder.title}</div>
                            <div class="folder-index">
                                <div class="pittogram">${renderIcon(folder.icon, folder.isIconImg)}</div>
                                <span class="count-badge">${dynamicCount}</span>
                            </div>
                            <div class="folder-content">${itemsHTML}</div>
                        </div>
                    </div>`;
                stack.insertAdjacentHTML('beforeend', folderHTML);
            });

            // 5. About & Contact
            const renderSection = (id, data) => {
                const container = document.getElementById(id);
                let html = '';
                data.forEach(block => {
                    if (block.type === 'text') {
                        html += `<div class="generic-card"><p>${block.content}</p></div>`;
                    } else if (block.type === 'card') {
                        const titleClass = (block.title === 'Vision' || block.title === 'Mission' || id === 'contact-content-area') ? 'blue-title' : '';
                        html += `<div class="generic-card"><h3 class="${titleClass}">${block.title}</h3><p>${block.text}</p></div>`;
                    }
                });
                container.innerHTML = html;
            };
            renderSection('about-content-area', DB.about);
            renderSection('contact-content-area', DB.contact);

            const gradient = document.querySelector('.top-gradient');
            document.querySelectorAll('.view-section').forEach(v => {
                v.addEventListener('scroll', () => {
                    if (v.scrollTop > 8) gradient.classList.add('visible');
                    else gradient.classList.remove('visible');
                }, { passive: true });
            });
        }

        function renderProgressGrid(selectedDay) {
            const gridContainer = document.getElementById('shared-grid-container');
            let gridHTML = '';
            const isFuture = selectedDay > currentDay; 

            const idMap = {
                'card-food': 'food',
                'card-clothes': 'clothes',
                'card-ritual': 'rituals', 
                'card-memories': 'memories'
            };

            DB.progress.forEach(p => {
                const archiveId = idMap[p.id];
                const archiveFolder = DB.archives.find(a => a.id === archiveId);
                
                let displayIcon = p.icon;
                let isImg = p.isImage;
                let count = 0;
                let lockedClass = isFuture ? 'locked' : '';
                let daysLeft = selectedDay - currentDay;

                if (!isFuture && archiveFolder && archiveFolder.items.length > 0) {
                      count = archiveFolder.items.length;
                      displayIcon = archiveFolder.items[0].icon;
                      isImg = archiveFolder.items[0].isItemImg;
                }

                gridHTML += `
                <div class="cat-card ${lockedClass}" id="${p.id}">
                    ${(!isFuture && count > 0) ? `<div class="notification-badge">${count}</div>` : ''}
                    <div class="cat-content">
                        <div class="cat-icon">${renderIcon(displayIcon, isImg)}</div>
                        <span class="cat-title">${p.title}</span>
                    </div>
                    <div class="lock-overlay"><i class="fas fa-lock lock-icon"></i><span class="lock-text">-${daysLeft} DAYS</span></div>
                </div>`;
            });
            gridContainer.innerHTML = gridHTML;
            
            document.querySelectorAll('.cat-card').forEach(card => {
                if (card.classList.contains('locked')) return;
                card.addEventListener('click', () => {
                    const idMapLocal = {
                        'card-food': 'food',
                        'card-clothes': 'clothes',
                        'card-ritual': 'rituals',
                        'card-memories': 'memories'
                    };
                    const archiveId = idMapLocal[card.id];
                    if (archiveId) {
                        goToFolder(archiveId);
                    }
                });
            });
        }

        function openItem(itemId) {
            const data = DB.items[itemId];
            if(!data) { console.warn("Item not found:", itemId); return; }

            // 1. Riferimenti al DOM
            const card = document.querySelector('.immersive-card');
            
            // 2. Pulizia preliminare (Rimuovi vecchi stati di lock)
            // Anche se ora li blocchiamo prima del click, è buona norma lasciare la pulizia
            card.classList.remove('locked');
            const oldOverlay = card.querySelector('.lock-overlay');
            if(oldOverlay) oldOverlay.remove();

            document.getElementById('uni-title').innerText = data.title;
            const imgContainer = document.querySelector('.card-image-container');
            imgContainer.innerHTML = `<div class="card-tag" id="uni-tag">${data.tag}</div>`;
            
            if (data.image.endsWith('.mp4') || data.image.endsWith('.webm')) {
                imgContainer.innerHTML += `<video src="${data.image}" controls autoplay loop muted style="width:100%; height:100%; object-fit:cover;"></video>`;
            } else {
                imgContainer.innerHTML += `<img id="uni-image" src="${data.image}" alt="Detail">`;
            }

            document.getElementById('uni-desc').innerText = data.description;
            const row = document.getElementById('uni-icons');

            if (data.icons && data.icons.length >= 3) {
                let iconHTML = '';
                iconHTML += renderIcon(data.icons[0].val, data.icons[0].isImg, "equation-icon");
                iconHTML += `<span>+</span>`;
                iconHTML += renderIcon(data.icons[1].val, data.icons[1].isImg, "equation-icon");
                iconHTML += `<span>+</span>`; 
                iconHTML += renderIcon(data.icons[2].val, data.icons[2].isImg, "equation-icon");
                iconHTML += `<span>=</span>`;
                if(data.icons[3]) { iconHTML += renderIcon(data.icons[3].val, data.icons[3].isImg, "equation-icon"); }
                row.innerHTML = iconHTML;
                row.style.display = 'flex'; 
            } else {
                row.style.display = 'none'; 
            }

            const table = document.getElementById('uni-table');
            table.innerHTML = '';
            if (data.details && Object.keys(data.details).length > 0) {
                for (const [k, v] of Object.entries(data.details)) {
                    table.innerHTML += `<div class="detail-row"><span class="detail-label">${k}</span><span class="detail-value">${v}</span></div>`;
                }
                table.style.display = '';
            } else {
                table.style.display = 'none';
            }

            switchTab('universal-detail');
        }

        function toggleFloatingMenu(e) { if(e) e.stopPropagation(); document.getElementById('floating-menu').classList.toggle('active'); }
        document.body.addEventListener('click', e => { 
            const menu = document.getElementById('floating-menu');
            if(menu && menu.classList.contains('active') && !menu.contains(e.target)) menu.classList.remove('active');
        });

        function toggleDiscovery() {
            const module = document.getElementById('discovery-module');
            const list = document.getElementById('discovery-list');
            const mainContent = document.getElementById('main-content');
            if (!module.classList.contains('expanded')) {
                module.classList.add('expanded');
                const desired = 93 + 45 + list.offsetHeight + 70; 
                const maxAllowed = Math.max(140, window.innerHeight + 60); 
                module.style.height = Math.min(desired, maxAllowed) + 'px';
                setTimeout(() => module.scrollIntoView({ behavior: 'smooth', block: 'center' }), 300);
            } else {
                module.classList.remove('expanded');
                module.style.height = '140px';
                setTimeout(() => mainContent.scrollTo({ top: 0, behavior: 'smooth' }), 100);
            }
            updateHeight();
        }

        function toggleFolder(el) {
            const isActive = el.classList.contains('active');
            document.querySelectorAll('.folder-item').forEach(e => {
                e.classList.remove('active');
                e.querySelector('.folder-face').style.height = ''; 
            });

            if (!isActive) {
                el.classList.add('active');
                const face = el.querySelector('.folder-face');
                const itemCount = el.querySelectorAll('.file-list-item').length;
                let dynamicHeight = 100 + (itemCount * 75) + 20;
                if (dynamicHeight < 189) { dynamicHeight = 189; }
                face.style.height = dynamicHeight + 'px';
            }

            let start = null;
            const step = t => { 
                if (!start) start = t; 
                updateHeight(); 
                if (t - start < 600) requestAnimationFrame(step); 
            };
            requestAnimationFrame(step);
        }

        function updateHeight() {
            const active = document.querySelector('.view-section.active');
            if(active) setTimeout(() => document.getElementById('dynamic-wrapper').style.height = '100%', 100);
        }
        window.addEventListener('load', () => { initApp(); setTimeout(updateHeight, 100); });
        window.addEventListener('resize', updateHeight);

        function selectDay(el, d) {
            document.querySelectorAll('.day').forEach(e => e.classList.remove('selected'));
            el.classList.add('selected');
            currentSelectedCalendarDay = d;
            renderProgressGrid(d);
        }

        function switchTab(name) {
            if (isAnimating) return; isAnimating = true;
            const header = document.getElementById('main-header');
            const titleEl = document.getElementById('page-title');
            const menu = document.getElementById('floating-menu');
            if(menu) menu.classList.remove('active');

            const discovery = document.getElementById('discovery-module');
            if (discovery && discovery.classList.contains('expanded')) {
                discovery.classList.remove('expanded');
                discovery.style.height = '140px';
            }

            document.querySelectorAll('.folder-item.active').forEach(f => {
                f.classList.remove('active');
                const face = f.querySelector('.folder-face');
                if (face) face.style.height = '';
            });

            if(menu) menu.classList.remove('active');
            
            const titles = { 
                home: "TODAY'S<br>DISCOVERIES", 
                progress: "PROGRESS", 
                archive: "ARCHIVE", 
                personal: "PERSONAL AREA", 
                about: "WHO WE ARE", 
                contact: "CONTACT US", 
                'universal-detail': "ARCHIVE DETAIL",
                'extra-content': "EXTRA CONTENT",
                plans: "PLANS"
            };
            const views = { 
                home: 'home-view', 
                progress: 'progress-view', 
                archive: 'archive-view', 
                personal: 'personal-view', 
                about: 'about-view', 
                contact: 'contact-view', 
                'universal-detail': 'universal-detail-view',
                'extra-content': 'extra-content-view',
                plans: 'plans-view'
            };
            
            const inc = document.getElementById(views[name]);
            const out = document.querySelector('.view-section.active');
            if (!inc || inc === out) { isAnimating = false; return; }

            if(name === 'home') { header.classList.add('home-mode'); if(menu) menu.classList.remove('hidden'); }
            else { header.classList.remove('home-mode'); titleEl.innerHTML = titles[name] || "UNEC"; if(menu) menu.classList.add('hidden'); }

            if(name === 'progress') {
                renderProgressGrid(currentSelectedCalendarDay);
                const cal = inc.querySelector('.calendar-container');
                cal.classList.remove('animate-entrance'); void cal.offsetWidth; cal.classList.add('animate-entrance');
            }

            // Force Re-render of extra content on tab switch to be safe
            if(name === 'extra-content') {
                renderExtraContent();
            }

            const navs = document.querySelectorAll('.nav-item');
            navs.forEach(n => n.classList.remove('active'));
            if(name === 'progress') navs[1].classList.add('active');
            else if(name === 'archive' || name === 'universal-detail') navs[2].classList.add('active');
            else if(['personal', 'about', 'contact'].includes(name) || name === 'plans') navs[3].classList.add('active');
            else navs[0].classList.add('active');

            inc.classList.add('measuring');
            const h = inc.getBoundingClientRect().height;
            inc.classList.remove('measuring');
            document.getElementById('dynamic-wrapper').style.height = h + 'px';

            if(out) { out.classList.remove('active'); out.style.opacity = 0; }
            inc.classList.add('active');
            
            const gradient = document.querySelector('.top-gradient');
            if (inc.scrollTop > 8) gradient.classList.add('visible'); else gradient.classList.remove('visible');
            void inc.offsetWidth; inc.style.opacity = 1; inc.style.transform = "none";
            document.getElementById('main-content').scrollTo({ top: 0, behavior: 'smooth' });

            setTimeout(() => { isAnimating = false; if(out) { out.style.opacity = ''; out.style.transform = ''; } }, 500);
        }
    </script>
</body>
</html>